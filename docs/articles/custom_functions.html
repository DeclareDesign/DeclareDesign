<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DeclareDesign - Custom functions and DeclareDesign</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../">DeclareDesign</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/idea.html">The Idea</a>
</li>
<li>
  <a href="../articles/design_library.html">Design Library</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Using DeclareDesign
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DeclareDesign.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/custom_functions.html">Custom functions</a>
    </li>
    <li>
      <a href="../articles/advanced_features.html">Advanced features</a>
    </li>
    <li>
      <a href="../articles/companion_packages.html">Companion packages</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="http://discuss.declaredesign.org">Ask for Help</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://declaredesign.org">DeclareDesign</a>
    </li>
    <li>
      <a href="http://randomizr.declaredesign.org">randomizr</a>
    </li>
    <li>
      <a href="http://fabricatr.declaredesign.org">fabricatr</a>
    </li>
    <li>
      <a href="http://estimatr.declaredesign.org">estimatr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a></a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Custom functions and DeclareDesign</h1>
            
          </div>

    
    
<div class="contents">
<p>Because all inputs to <code><a href="../reference/declare_design.html">declare_design()</a></code> are functions, itâ€™s easy for you to provide custom functions instead of using our defaults.</p>
<div id="custom-population" class="section level1">
<h1 class="hasAnchor">
<a href="#custom-population" class="anchor"></a>Custom Population</h1>
<p>You can use a custom function to generate your population entirely on your own, too:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_population_function &lt;-<span class="st"> </span><span class="cf">function</span>(N) {
  <span class="kw">data.frame</span>(<span class="dt">u =</span> <span class="kw">rnorm</span>(N))
}

my_population_custom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_population.html">declare_population</a></span>(
  <span class="dt">population_function =</span> my_population_function, <span class="dt">N =</span> <span class="dv">100</span>)

pop_custom &lt;-<span class="st"> </span><span class="kw">my_population_custom</span>()

<span class="kw">head</span>(pop_custom)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">u</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.35</td>
</tr>
<tr class="even">
<td align="right">0.61</td>
</tr>
<tr class="odd">
<td align="right">0.74</td>
</tr>
<tr class="even">
<td align="right">0.48</td>
</tr>
<tr class="odd">
<td align="right">0.33</td>
</tr>
<tr class="even">
<td align="right">-1.78</td>
</tr>
</tbody>
</table>
</div>
<div id="custom-potential-outcomes" class="section level1">
<h1 class="hasAnchor">
<a href="#custom-potential-outcomes" class="anchor"></a>Custom Potential Outcomes</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_potential_outcomes_function &lt;-
<span class="st">  </span><span class="cf">function</span>(data) {
    data<span class="op">$</span>Y_Z_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">with</span>(data, u)
    data<span class="op">$</span>Y_Z_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">with</span>(data, <span class="fl">0.25</span> <span class="op">+</span><span class="st"> </span>u)
    data
  }
my_potential_outcomes_custom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_potential_outcomes.html">declare_potential_outcomes</a></span>(
  <span class="dt">potential_outcomes_function =</span> my_potential_outcomes_function
)

pop_pos_custom &lt;-<span class="st"> </span><span class="kw">my_potential_outcomes_custom</span>(pop_custom)

<span class="kw">head</span>(pop_pos_custom[, <span class="kw">c</span>(<span class="st">"u"</span>, <span class="st">"Y_Z_0"</span>, <span class="st">"Y_Z_1"</span>)])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">u</th>
<th align="right">Y_Z_0</th>
<th align="right">Y_Z_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.35</td>
<td align="right">-0.35</td>
<td align="right">-0.10</td>
</tr>
<tr class="even">
<td align="right">0.61</td>
<td align="right">0.61</td>
<td align="right">0.86</td>
</tr>
<tr class="odd">
<td align="right">0.74</td>
<td align="right">0.74</td>
<td align="right">0.99</td>
</tr>
<tr class="even">
<td align="right">0.48</td>
<td align="right">0.48</td>
<td align="right">0.73</td>
</tr>
<tr class="odd">
<td align="right">0.33</td>
<td align="right">0.33</td>
<td align="right">0.58</td>
</tr>
<tr class="even">
<td align="right">-1.78</td>
<td align="right">-1.78</td>
<td align="right">-1.53</td>
</tr>
</tbody>
</table>
</div>
<div id="custom-sampling" class="section level1">
<h1 class="hasAnchor">
<a href="#custom-sampling" class="anchor"></a>Custom Sampling</h1>
<p>Again, you can still use a custom sampling function easily. In this case, the requirement is simply that the function takes population data and returns sampled data. You can also include inclusion weights if you wish in the function (as the default function does).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_sampling_function &lt;-<span class="st"> </span><span class="cf">function</span>(data) {
     data<span class="op">$</span>S &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(data),
            <span class="dt">size =</span> <span class="dv">1</span>,
            <span class="dt">prob =</span> <span class="fl">0.1</span>)
     data[data<span class="op">$</span>S <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ]
}

my_sampling_custom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_sampling.html">declare_sampling</a></span>(
  <span class="dt">sampling_function =</span> my_sampling_function)

smp_custom &lt;-<span class="st"> </span><span class="kw">my_sampling_custom</span>(pop_pos)

<span class="kw">nrow</span>(smp_custom)</code></pre></div>
<p>107</p>
</div>
<div id="custom-assignment" class="section level1">
<h1 class="hasAnchor">
<a href="#custom-assignment" class="anchor"></a>Custom Assignment</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_assignment_function &lt;-<span class="st"> </span><span class="cf">function</span>(data) {
  data<span class="op">$</span>Z &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(data),
         <span class="dt">size =</span> <span class="dv">1</span>,
         <span class="dt">prob =</span> <span class="fl">0.5</span>)
  data
}
my_assignment_custom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_assignment.html">declare_assignment</a></span>(
  <span class="dt">assignment_function =</span> my_assignment_function)

<span class="kw">table</span>(<span class="kw">my_assignment_custom</span>(pop_pos)<span class="op">$</span>Z)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">0</th>
<th align="right">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">504</td>
<td align="right">496</td>
</tr></tbody>
</table>
</div>
<div id="custom-estimand" class="section level1">
<h1 class="hasAnchor">
<a href="#custom-estimand" class="anchor"></a>Custom Estimand</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_estimand_function &lt;-<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">with</span>(data, <span class="kw">median</span>(Y_Z_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Y_Z_<span class="dv">0</span>))
}
my_estimand_custom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_estimand.html">declare_estimand</a></span>(
  <span class="dt">estimand_function =</span> my_estimand_function, <span class="dt">label =</span> medianTE)

<span class="kw">my_estimand_custom</span>(pop_pos)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">estimand_label</th>
<th align="right">estimand</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">medianTE</td>
<td align="right">0.82</td>
</tr></tbody>
</table>
</div>
<div id="custom-estimator" class="section level1">
<h1 class="hasAnchor">
<a href="#custom-estimator" class="anchor"></a>Custom Estimator</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_estimator_function &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data){
  <span class="kw">data.frame</span>(<span class="dt">est =</span> <span class="kw">with</span>(data, <span class="kw">mean</span>(Y)))
}

my_estimator_custom &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/declare_estimator.html">declare_estimator</a></span>(Y <span class="op">~</span><span class="st"> </span>Z, 
                    <span class="dt">estimator_function =</span> my_estimator_function, 
                    <span class="dt">estimand =</span> my_estimand)

<span class="kw">my_estimator_custom</span>(smp)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">estimator_label</th>
<th align="right">est</th>
<th align="left">estimand_label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">my_estimator</td>
<td align="right">0.09</td>
<td align="left">ATE</td>
</tr></tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#custom-population">Custom Population</a></li>
      <li><a href="#custom-potential-outcomes">Custom Potential Outcomes</a></li>
      <li><a href="#custom-sampling">Custom Sampling</a></li>
      <li><a href="#custom-assignment">Custom Assignment</a></li>
      <li><a href="#custom-estimand">Custom Estimand</a></li>
      <li><a href="#custom-estimator">Custom Estimator</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright" style="flex:3;">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys.</p>
  <p>Code is licensed under <a href="https://opensource.org/licenses/mit-license.php">MIT</a> license.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
