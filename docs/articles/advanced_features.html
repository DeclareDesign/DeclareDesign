<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DeclareDesign - Advanced features</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../">DeclareDesign</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/idea.html">The Idea</a>
</li>
<li>
  <a href="../articles/design_library.html">Design Library</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Using DeclareDesign
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DeclareDesign.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/custom_functions.html">Custom functions</a>
    </li>
    <li>
      <a href="../articles/advanced_features.html">Advanced features</a>
    </li>
    <li>
      <a href="../articles/companion_packages.html">Companion packages</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="http://discuss.declaredesign.org">Ask for Help</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://declaredesign.org">DeclareDesign</a>
    </li>
    <li>
      <a href="http://randomizr.declaredesign.org">randomizr</a>
    </li>
    <li>
      <a href="http://fabricatr.declaredesign.org">fabricatr</a>
    </li>
    <li>
      <a href="http://estimatr.declaredesign.org">estimatr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a></a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Advanced features</h1>
            
          </div>

    
    
<div class="contents">
<div id="quick-design" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-design" class="anchor"></a>Quick design</h1>
<p>You can also write a design maker function that declares a design based on a set of parameters like <code>N</code>, the number of clusters, etc. and use the function <code><a href="../reference/quick_design.html">quick_design()</a></code> to make designs using just those parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m_arm_trial &lt;-<span class="st"> </span><span class="cf">function</span>(numb){
  my_population &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_population.html">declare_population</a></span>(
    <span class="dt">N =</span> numb, <span class="dt">income =</span> <span class="kw">rnorm</span>(N), <span class="dt">age =</span> <span class="kw">sample</span>(<span class="dv">18</span><span class="op">:</span><span class="dv">95</span>, N, <span class="dt">replace =</span> T))

  my_potential_outcomes &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_potential_outcomes.html">declare_potential_outcomes</a></span>(
    <span class="dt">formula =</span> Y <span class="op">~</span><span class="st"> </span>.<span class="dv">25</span> <span class="op">*</span><span class="st"> </span>Z <span class="op">+</span><span class="st"> </span>.<span class="dv">01</span> <span class="op">*</span><span class="st"> </span>age <span class="op">*</span><span class="st"> </span>Z)
  my_sampling &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_sampling.html">declare_sampling</a></span>(<span class="dt">n =</span> <span class="dv">250</span>)
  my_assignment &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_assignment.html">declare_assignment</a></span>(<span class="dt">m =</span> <span class="dv">25</span>)
  my_estimand &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_estimand.html">declare_estimand</a></span>(<span class="dt">ATE =</span> <span class="kw">mean</span>(Y_Z_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Y_Z_<span class="dv">0</span>))
  my_estimator_dim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_estimator.html">declare_estimator</a></span>(Y <span class="op">~</span><span class="st"> </span>Z, <span class="dt">estimand =</span> my_estimand)
  my_design &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_design.html">declare_design</a></span>(my_population,
                              my_potential_outcomes,
                              my_estimand,
                              my_sampling,
                              my_assignment,
                              reveal_outcomes,
                              my_estimator_dim)
  <span class="kw">return</span>(my_design)
}

my_1000_design &lt;-<span class="st"> </span><span class="kw"><a href="../reference/quick_design.html">quick_design</a></span>(<span class="dt">template =</span> m_arm_trial, <span class="dt">numb =</span> <span class="dv">1000</span>)
<span class="kw">head</span>(<span class="kw"><a href="../reference/post_design.html">draw_data</a></span>(my_1000_design))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">ID</th>
<th align="right">income</th>
<th align="right">age</th>
<th align="right">Y_Z_0</th>
<th align="right">Y_Z_1</th>
<th align="right">S_inclusion_prob</th>
<th align="right">Z</th>
<th align="right">Z_cond_prob</th>
<th align="right">Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>7</td>
<td align="left">0007</td>
<td align="right">-0.96</td>
<td align="right">51</td>
<td align="right">0</td>
<td align="right">0.76</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>10</td>
<td align="left">0010</td>
<td align="right">1.51</td>
<td align="right">40</td>
<td align="right">0</td>
<td align="right">0.65</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>11</td>
<td align="left">0011</td>
<td align="right">2.35</td>
<td align="right">75</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>20</td>
<td align="left">0020</td>
<td align="right">-0.28</td>
<td align="right">21</td>
<td align="right">0</td>
<td align="right">0.46</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>23</td>
<td align="left">0023</td>
<td align="right">-0.02</td>
<td align="right">55</td>
<td align="right">0</td>
<td align="right">0.80</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>27</td>
<td align="left">0027</td>
<td align="right">0.27</td>
<td align="right">51</td>
<td align="right">0</td>
<td align="right">0.76</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="continuous-potential-outcomes" class="section level1">
<h1 class="hasAnchor">
<a href="#continuous-potential-outcomes" class="anchor"></a>Continuous potential outcomes</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_potential_outcomes_continuous &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_potential_outcomes.html">declare_potential_outcomes</a></span>(
  <span class="dt">formula =</span> Y <span class="op">~</span><span class="st"> </span>.<span class="dv">25</span> <span class="op">*</span><span class="st"> </span>Z <span class="op">+</span><span class="st"> </span>.<span class="dv">01</span> <span class="op">*</span><span class="st"> </span>age <span class="op">*</span><span class="st"> </span>Z, <span class="dt">condition_names =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> .<span class="dv">1</span>))

continuous_treatment_function &lt;-<span class="st"> </span><span class="cf">function</span>(data){
 data<span class="op">$</span>Z &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> .<span class="dv">1</span>), <span class="dt">size =</span> <span class="kw">nrow</span>(data), <span class="dt">replace =</span> <span class="ot">TRUE</span>)
 data
}

my_assignment_continuous &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_assignment.html">declare_assignment</a></span>(<span class="dt">assignment_function =</span> continuous_treatment_function)

my_design &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_design.html">declare_design</a></span>(<span class="kw">my_population</span>(),
                            my_potential_outcomes_continuous,
                            my_assignment_continuous,
                            reveal_outcomes)

<span class="kw">head</span>(<span class="kw"><a href="../reference/post_design.html">draw_data</a></span>(my_design))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">ID</th>
<th align="right">income</th>
<th align="right">age</th>
<th align="right">Y_Z_0</th>
<th align="right">Y_Z_0.1</th>
<th align="right">Y_Z_0.2</th>
<th align="right">Y_Z_0.3</th>
<th align="right">Y_Z_0.4</th>
<th align="right">Y_Z_0.5</th>
<th align="right">Y_Z_0.6</th>
<th align="right">Y_Z_0.7</th>
<th align="right">Y_Z_0.8</th>
<th align="right">Y_Z_0.9</th>
<th align="right">Y_Z_1</th>
<th align="right">Z</th>
<th align="right">Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.30</td>
<td align="right">35</td>
<td align="right">0</td>
<td align="right">0.06</td>
<td align="right">0.12</td>
<td align="right">0.18</td>
<td align="right">0.24</td>
<td align="right">0.30</td>
<td align="right">0.36</td>
<td align="right">0.42</td>
<td align="right">0.48</td>
<td align="right">0.54</td>
<td align="right">0.60</td>
<td align="right">0.8</td>
<td align="right">0.48</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0.37</td>
<td align="right">73</td>
<td align="right">0</td>
<td align="right">0.10</td>
<td align="right">0.20</td>
<td align="right">0.29</td>
<td align="right">0.39</td>
<td align="right">0.49</td>
<td align="right">0.59</td>
<td align="right">0.69</td>
<td align="right">0.78</td>
<td align="right">0.88</td>
<td align="right">0.98</td>
<td align="right">0.3</td>
<td align="right">0.29</td>
</tr>
<tr class="odd">
<td align="left">0003</td>
<td align="right">1.85</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">0.06</td>
<td align="right">0.12</td>
<td align="right">0.18</td>
<td align="right">0.24</td>
<td align="right">0.30</td>
<td align="right">0.37</td>
<td align="right">0.43</td>
<td align="right">0.49</td>
<td align="right">0.55</td>
<td align="right">0.61</td>
<td align="right">0.3</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td align="left">0004</td>
<td align="right">-0.50</td>
<td align="right">26</td>
<td align="right">0</td>
<td align="right">0.05</td>
<td align="right">0.10</td>
<td align="right">0.15</td>
<td align="right">0.20</td>
<td align="right">0.26</td>
<td align="right">0.31</td>
<td align="right">0.36</td>
<td align="right">0.41</td>
<td align="right">0.46</td>
<td align="right">0.51</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">0005</td>
<td align="right">0.06</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">0.04</td>
<td align="right">0.09</td>
<td align="right">0.13</td>
<td align="right">0.18</td>
<td align="right">0.22</td>
<td align="right">0.26</td>
<td align="right">0.31</td>
<td align="right">0.35</td>
<td align="right">0.40</td>
<td align="right">0.44</td>
<td align="right">0.5</td>
<td align="right">0.22</td>
</tr>
<tr class="even">
<td align="left">0006</td>
<td align="right">-0.06</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">0.08</td>
<td align="right">0.15</td>
<td align="right">0.23</td>
<td align="right">0.30</td>
<td align="right">0.38</td>
<td align="right">0.45</td>
<td align="right">0.52</td>
<td align="right">0.60</td>
<td align="right">0.68</td>
<td align="right">0.75</td>
<td align="right">0.5</td>
<td align="right">0.38</td>
</tr>
</tbody>
</table>
</div>
<div id="attrition" class="section level1">
<h1 class="hasAnchor">
<a href="#attrition" class="anchor"></a>Attrition</h1>
<p>Attrition can be thought of as just another potential outcome. That is, one describe possible attrition processes, include them in the design, and see how estimation strategies are affected by these processes. Here is an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_potential_outcomes_attrition &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_potential_outcomes.html">declare_potential_outcomes</a></span>(
  <span class="dt">formula =</span> R <span class="op">~</span><span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> N, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="kw">pnorm</span>(Y_Z_<span class="dv">0</span>)))

my_design &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_design.html">declare_design</a></span>(<span class="kw">my_population</span>(),
                            my_potential_outcomes,
                            my_potential_outcomes_attrition,
                            my_assignment,
                            <span class="kw"><a href="../reference/reveal_outcomes.html">reveal_outcomes</a></span>(<span class="dt">outcome_variable_name =</span> <span class="st">"R"</span>),
                            <span class="kw"><a href="../reference/reveal_outcomes.html">reveal_outcomes</a></span>(<span class="dt">attrition_variable_name =</span> <span class="st">"R"</span>))

<span class="kw">head</span>(<span class="kw"><a href="../reference/post_design.html">draw_data</a></span>(my_design)[, <span class="kw">c</span>(<span class="st">"ID"</span>, <span class="st">"Y_Z_0"</span>, <span class="st">"Y_Z_1"</span>, <span class="st">"R_Z_0"</span>, <span class="st">"R_Z_1"</span>, <span class="st">"Z"</span>, <span class="st">"R"</span>, <span class="st">"Y"</span>)])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">ID</th>
<th align="right">Y_Z_0</th>
<th align="right">Y_Z_1</th>
<th align="right">R_Z_0</th>
<th align="right">R_Z_1</th>
<th align="right">Z</th>
<th align="right">R</th>
<th align="right">Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0</td>
<td align="right">0.85</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0</td>
<td align="right">1.13</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0003</td>
<td align="right">0</td>
<td align="right">1.04</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">0004</td>
<td align="right">0</td>
<td align="right">0.90</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0005</td>
<td align="right">0</td>
<td align="right">1.14</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0006</td>
<td align="right">0</td>
<td align="right">0.73</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="stochastic-population-sizes" class="section level1">
<h1 class="hasAnchor">
<a href="#stochastic-population-sizes" class="anchor"></a>Stochastic population sizes</h1>
<p>The population (or any level of the population) can have stochastic population sizes. (In fact, N can be a number, a fixed vector of numbers, or an expression that returns a stochastic number or vector of numbers.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stochastic_population &lt;-<span class="st"> </span><span class="kw"><a href="../reference/declare_population.html">declare_population</a></span>(
  <span class="dt">N =</span> <span class="kw">sample</span>(<span class="dv">500</span><span class="op">:</span><span class="dv">1000</span>, <span class="dv">1</span>), <span class="dt">income =</span> <span class="kw">rnorm</span>(N), <span class="dt">age =</span> <span class="kw">sample</span>(<span class="dv">18</span><span class="op">:</span><span class="dv">95</span>, N, <span class="dt">replace =</span> <span class="ot">TRUE</span>))

<span class="kw">c</span>(<span class="kw">nrow</span>(<span class="kw">stochastic_population</span>()), 
  <span class="kw">nrow</span>(<span class="kw">stochastic_population</span>()), 
  <span class="kw">nrow</span>(<span class="kw">stochastic_population</span>()))</code></pre></div>
<p>768, 815, 950</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#quick-design">Quick design</a></li>
      <li><a href="#continuous-potential-outcomes">Continuous potential outcomes</a></li>
      <li><a href="#attrition">Attrition</a></li>
      <li><a href="#stochastic-population-sizes">Stochastic population sizes</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright" style="flex:3;">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys.</p>
  <p>Code is licensed under <a href="https://opensource.org/licenses/mit-license.php">MIT</a> license.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
